<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juego de Vestir Personajes con QR - Versión 2</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        /* Mantengo todo tu CSS original */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: white;
        }
        header { text-align: center; margin-bottom: 20px; width: 100%; }
        h1 { font-size: 2.5rem; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .subtitle { font-size: 1.2rem; opacity: 0.9; max-width: 600px; margin: 0 auto; }
        .app-container { display: flex; flex-wrap: wrap; gap: 20px; max-width: 1200px; width: 100%; justify-content: center; }
        .scanner-section, .character-section {
            flex: 1;
            min-width: 300px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        .character-section { display: flex; flex-direction: column; }
        .section-title { font-size: 1.5rem; margin-bottom: 15px; text-align: center; }
        #video-container { width: 100%; height: 300px; border-radius: 10px; overflow: hidden; position: relative; margin-bottom: 15px; }
        .controls { display: flex; flex-direction: column; gap: 10px; }
        button {
            background: linear-gradient(to right, #ff416c, #ff4b2b);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        button:hover { transform: translateY(-3px); box-shadow: 0 6px 20px rgba(0,0,0,0.3); }
        button:active { transform: translateY(1px); }
        #reset-btn { background: linear-gradient(to right, #11998e, #38ef7d); }
        #check-btn { background: linear-gradient(to right, #4A00E0, #8E2DE2); }
        .character-display { flex: 1; display: flex; justify-content: center; align-items: center; position: relative; min-height: 300px; background: rgba(0,0,0,0.2); border-radius: 10px; overflow: hidden; }
        .character-base { position: absolute; max-width: 80%; max-height: 80%; }
        .clothing-layer { position: absolute; max-width: 80%; max-height: 80%; }
        .character-info { background: rgba(0,0,0,0.3); border-radius: 10px; padding: 15px; margin-top: 20px; }
        .info-item { margin-bottom: 10px; }
        .info-label { font-weight: bold; display: inline-block; width: 120px; }
        .status-message { text-align: center; padding: 15px; border-radius: 10px; margin-top: 20px; font-weight: bold; min-height: 20px; }
        .success { background: rgba(46, 204, 113, 0.3); border: 1px solid #2ecc71; }
        .error { background: rgba(231, 76, 60, 0.3); border: 1px solid #e74c3c; }
        .instructions { max-width: 800px; background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); border-radius: 15px; padding: 20px; margin-top: 20px; box-shadow: 0 8px 32px rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.18); }
        .instructions h2 { margin-bottom: 15px; text-align: center; }
        .instructions ol { padding-left: 20px; }
        .instructions li { margin-bottom: 10px; line-height: 1.5; }
        .hidden { display: none; }
        @media (max-width: 768px) { .app-container { flex-direction: column; } h1 { font-size: 2rem; } }
    </style>
</head>
<body>
    <header>
        <h1>Juego de Vestir Personajes</h1>
        <p class="subtitle">Escanea códigos QR para vestir a los personajes con prendas que coincidan con sus preferencias</p>
    </header>
    
    <div class="app-container">
        <section class="scanner-section">
            <h2 class="section-title">Escáner QR</h2>
            <div id="video-container"></div>
            <div class="controls">
                <button id="start-camera">Iniciar Cámara</button>
                <button id="reset-btn">Reiniciar Juego</button>
                <button id="check-btn">Comprobar Outfit</button>
            </div>
            <div id="scan-status" class="status-message">Presiona "Iniciar Cámara" para comenzar</div>
        </section>
        
        <section class="character-section">
            <h2 class="section-title">Personaje</h2>
            <div class="character-display">
                <img id="character-base" class="character-base hidden" alt="Personaje base">
            </div>
            <div class="character-info">
                <div class="info-item">
                    <span class="info-label">Nombre:</span>
                    <span id="character-name">-</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Preferencias:</span>
                    <span id="character-preferences">-</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Prendas:</span>
                    <span id="clothing-count">0</span>
                </div>
            </div>
            <div id="game-result" class="status-message hidden"></div>
        </section>
    </div>
    
    <section class="instructions">
        <h2>Instrucciones del Juego</h2>
        <ol>
            <li>Presiona "Iniciar Cámara" para activar la cámara de tu dispositivo</li>
            <li>Escanea primero el código QR de un personaje para seleccionarlo</li>
            <li>Luego escanea códigos QR de prendas de vestir en el orden que desees</li>
            <li>Las prendas se superpondrán automáticamente sobre el personaje</li>
            <li>Cada prenda tiene puntos asociados según las preferencias del personaje</li>
            <li>Cuando hayas terminado, presiona "Comprobar Outfit" para ver si acertaste</li>
            <li>Usa "Reiniciar Juego" para comenzar una nueva partida</li>
        </ol>
    </section>

    <script>
        // Tus datos originales
        const characters = {
            "P1": { id: "P1", name: "Luna", size: "S", preferences: ["marron", "rojo", "casual"], baseImage: "IMAGES/P1_base.png", validClothes: ["camiseta_01", "camiseta_02", "falda_01", "falda_02","vestido_01"] },
            "P2": { id: "P2", name: "Sol", size: "M", preferences: ["hippie", "verde", "amarillo"], baseImage: "IMAGES/P2_base.png", validClothes: ["camiseta_01", "pendientes_01", "pendientes_02", "vestido_01", "vestido_02"] },
            "CHAR003": { id: "CHAR003", name: "Estrella", size: "L", preferences: ["ciencia", "lectura", "astronomía"], baseImage: "https://placehold.co/400x500/9370DB/000000?text=Estrella+(L)", validClothes: ["CLOTH001", "CLOTH004", "CLOTH005"] }
        };

        const clothes = {
            "camiseta_01": { id: "camiseta_01", name: "Camiseta Roja", sizes: { "S": "IMAGES/P1_camiseta_01.png", "M": "IMAGES/P2_camiseta_01.png", "L": "https://placehold.co/400x500/FF0000/FFFFFF?text=Camiseta+Roja+(L)", "XL": "https://placehold.co/450x550/FF0000/FFFFFF?text=Camiseta+Roja+(XL)" }, points: { "azul":0,"rojo":20,"marron":0,"verde":0,"amarillo":0,"casual":20 } },
            "camiseta_02": { id: "camiseta_02", name: "Camiseta Azul", sizes: { "S": "IMAGES/P1_camiseta_02.png", "M": "IMAGES/P2_camiseta_02.png", "L": "https://placehold.co/400x500/0000FF/FFFFFF?text=Pantalón+Azul+(L)", "XL": "https://placehold.co/450x550/0000FF/FFFFFF?text=Pantalón+Azul+(XL)" }, points: { "azul":20,"rojo":0,"marron":0,"verde":0,"amarillo":0,"elegante":20 } }
        };

        // Elementos DOM
        const characterBase = document.getElementById('character-base');
        const characterName = document.getElementById('character-name');
        const characterPreferences = document.getElementById('character-preferences');
        const clothingCount = document.getElementById('clothing-count');
        const gameResult = document.getElementById('game-result');
        const characterDisplay = document.querySelector('.character-display');
        const scanStatus = document.getElementById('scan-status');
        const startCameraBtn = document.getElementById('start-camera');
        const resetBtn = document.getElementById('reset-btn');
        const checkBtn = document.getElementById('check-btn');

        let currentCharacter = null;
        let scannedClothes = [];
        let totalPoints = 0;
        let html5QrcodeScanner = null;

        // Función para iniciar cámara y QR
        startCameraBtn.addEventListener('click', () => {
            scanStatus.textContent = "Enfoca un código QR para escanear";
            if (!html5QrcodeScanner) {
                html5QrcodeScanner = new Html5QrcodeScanner(
                    "video-container", { fps: 10, qrbox: 250 });
            }
            html5QrcodeScanner.render(onScanSuccess);
        });

        function onScanSuccess(decodedText, decodedResult) {
            if (characters[decodedText]) {
                selectCharacter(characters[decodedText]);
                scanStatus.textContent = `Personaje seleccionado: ${characters[decodedText].name}`;
                scanStatus.className = "status-message success";
            } else if (clothes[decodedText]) {
                if (currentCharacter) {
                    addClothing(clothes[decodedText]);
                    scanStatus.textContent = `Prenda añadida: ${clothes[decodedText].name}`;
                    scanStatus.className = "status-message success";
                } else {
                    scanStatus.textContent = "Primero debes escanear un personaje";
                    scanStatus.className = "status-message error";
                }
            } else {
                scanStatus.textContent = "Código QR no reconocido";
                scanStatus.className = "status-message error";
            }
        }

        function selectCharacter(character) {
            currentCharacter = character;
            characterBase.src = character.baseImage;
            characterBase.classList.remove('hidden');
            characterName.textContent = character.name;
            characterPreferences.textContent = character.preferences.join(', ');
            clothingCount.textContent = '0';
            scannedClothes = [];
            totalPoints = 0;
            const clothingLayers = document.querySelectorAll('.clothing-layer');
            clothingLayers.forEach(layer => layer.remove());
            gameResult.classList.add('hidden');
        }

        function addClothing(cloth) {
            if (!currentCharacter) return;
            scannedClothes.push(cloth);
            clothingCount.textContent = scannedClothes.length;
            let clothPoints = 0;
            currentCharacter.preferences.forEach(pref => {
                if (cloth.points[pref]) clothPoints += cloth.points[pref];
            });
            totalPoints += clothPoints;
            const clothLayer = document.createElement('img');
            clothLayer.src = cloth.sizes[currentCharacter.size] || cloth.sizes['M'];
            clothLayer.alt = cloth.name;
            clothLayer.className = 'clothing-layer';
            characterDisplay.appendChild(clothLayer);
        }

        checkBtn.addEventListener('click', () => {
            if (!currentCharacter) {
                gameResult.textContent = "Primero debes escanear un personaje";
                gameResult.className = "status-message error";
                gameResult.classList.remove('hidden');
                return;
            }
            if (scannedClothes.length === 0) {
                gameResult.textContent = "Añade al menos una prenda antes de comprobar";
                gameResult.className = "status-message error";
                gameResult.classList.remove('hidden');
                return;
            }
            let validOutfit = true;
            let validCount = 0;
            scannedClothes.forEach(cloth => {
                if (currentCharacter.validClothes.includes(cloth.id)) validCount++;
                else validOutfit = false;
            });
            const accuracy = Math.round((validCount / scannedClothes.length) * 100);
            if (validOutfit && scannedClothes.length >= 2) {
                gameResult.textContent = `¡Outfit perfecto! Has conseguido ${totalPoints} puntos.`;
                gameResult.className = "status-message success";
            } else if (accuracy >= 50) {
                gameResult.textContent = `Buen intento (${accuracy}% correcto). Puntos obtenidos: ${totalPoints}`;
                gameResult.className = "status-message success";
            } else {
                gameResult.textContent = `Outfit incorrecto (${accuracy}% correcto). Puntos obtenidos: ${totalPoints}`;
                gameResult.className = "status-message error";
            }
            gameResult.classList.remove('hidden');
        });

        resetBtn.addEventListener('click', () => {
            if (html5QrcodeScanner) html5QrcodeScanner.clear();
            currentCharacter = null;
            scannedClothes = [];
            totalPoints = 0;
            characterBase.src = '';
            characterBase.classList.add('hidden');
            characterName.textContent = '-';
            characterPreferences.textContent = '-';
            clothingCount.textContent = '0';
            const clothingLayers = document.querySelectorAll('.clothing-layer');
            clothingLayers.forEach(layer => layer.remove());
            scanStatus.textContent = "Presiona 'Iniciar Cámara' para comenzar";
            scanStatus.className = "status-message";
            gameResult.classList.add('hidden');
        });
    </script>
</body>
</html>
